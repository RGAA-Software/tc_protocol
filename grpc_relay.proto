syntax = "proto3";
package grpc_relay;

service GrpcRelay {
  rpc HeartBeat (HeartBeatRequest) returns (HeartBeatReply) {}
  rpc StreamRequest(stream RelayStreamRequest) returns (stream RelayStreamReply) {}
  rpc QueryDevice(RelayQueryDeviceRequest) returns (RelayQueryDeviceReply) {}
  rpc QueryRelayRoomsCount(RelayRoomsCountRequest) returns (RelayRoomsCountReply) {}
}

// HeartBeat
message HeartBeatRequest {
  string server_id = 1;
  int64 hb_index = 2;
}

message HeartBeatReply {
  string server_id = 1;
  int64 hb_index = 2;
}

// Server Information
message ServerInformationRequest {
  string server_id = 1;
  string pub_ip = 2;
  string port = 3;
}

message ServerInformationReply {

}

// stream
message RelayStreamRequest {
  string server_id = 1;
  string message = 2;
}

message RelayStreamReply {
  string server_id = 1;
  string message = 2;
}

// query device
message RelayQueryDeviceRequest {
  string device_id = 1;
}

message RelayQueryDeviceReply {
  bool has_device = 1;
  string device_id = 2;
  string client_w3c_ip = 3;
  repeated string client_local_ips = 4;
  string server_w3c_ip = 5;
  string server_local_ip = 6;
  int32 server_grpc_port = 7;
  int32 server_working_port = 8;
}

// relay rooms
message RelayRoomsCountRequest {

}

message RelayRoomsCountReply {
    uint32 count = 1;
}